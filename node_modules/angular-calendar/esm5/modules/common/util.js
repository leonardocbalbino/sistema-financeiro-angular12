import { __read, __spread } from "tslib";
import { validateEvents as validateEventsWithoutLog, } from 'calendar-utils';
export var validateEvents = function (events) {
    var warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        return console.warn.apply(console, __spread(['angular-calendar'], args));
    };
    return validateEventsWithoutLog(events, warn);
};
export function isInside(outer, inner) {
    return (Math.floor(outer.left) <= Math.ceil(inner.left) &&
        Math.floor(inner.left) <= Math.ceil(outer.right) &&
        Math.floor(outer.left) <= Math.ceil(inner.right) &&
        Math.floor(inner.right) <= Math.ceil(outer.right) &&
        Math.floor(outer.top) <= Math.ceil(inner.top) &&
        Math.floor(inner.top) <= Math.ceil(outer.bottom) &&
        Math.floor(outer.top) <= Math.ceil(inner.bottom) &&
        Math.floor(inner.bottom) <= Math.ceil(outer.bottom));
}
export function roundToNearest(amount, precision) {
    return Math.round(amount / precision) * precision;
}
export var trackByEventId = function (index, event) {
    return event.id ? event.id : event;
};
export var trackByWeekDayHeaderDate = function (index, day) {
    return day.date.toISOString();
};
export var trackByHourSegment = function (index, segment) { return segment.date.toISOString(); };
export var trackByHour = function (index, hour) {
    return hour.segments[0].date.toISOString();
};
export var trackByWeekAllDayEvent = function (index, weekEvent) { return (weekEvent.event.id ? weekEvent.event.id : weekEvent.event); };
export var trackByWeekTimeEvent = function (index, weekEvent) { return (weekEvent.event.id ? weekEvent.event.id : weekEvent.event); };
var MINUTES_IN_HOUR = 60;
function getPixelAmountInMinutes(hourSegments, hourSegmentHeight) {
    return MINUTES_IN_HOUR / (hourSegments * hourSegmentHeight);
}
export function getMinutesMoved(movedY, hourSegments, hourSegmentHeight, eventSnapSize) {
    var draggedInPixelsSnapSize = roundToNearest(movedY, eventSnapSize || hourSegmentHeight);
    var pixelAmountInMinutes = getPixelAmountInMinutes(hourSegments, hourSegmentHeight);
    return draggedInPixelsSnapSize * pixelAmountInMinutes;
}
export function getMinimumEventHeightInMinutes(hourSegments, hourSegmentHeight) {
    return (getPixelAmountInMinutes(hourSegments, hourSegmentHeight) * hourSegmentHeight);
}
export function getDefaultEventEnd(dateAdapter, event, minimumMinutes) {
    if (event.end) {
        return event.end;
    }
    else {
        return dateAdapter.addMinutes(event.start, minimumMinutes);
    }
}
export function addDaysWithExclusions(dateAdapter, date, days, excluded) {
    var daysCounter = 0;
    var daysToAdd = 0;
    var changeDays = days < 0 ? dateAdapter.subDays : dateAdapter.addDays;
    var result = date;
    while (daysToAdd <= Math.abs(days)) {
        result = changeDays(date, daysCounter);
        var day = dateAdapter.getDay(result);
        if (excluded.indexOf(day) === -1) {
            daysToAdd++;
        }
        daysCounter++;
    }
    return result;
}
export function isDraggedWithinPeriod(newStart, newEnd, period) {
    var end = newEnd || newStart;
    return ((period.start <= newStart && newStart <= period.end) ||
        (period.start <= end && end <= period.end));
}
export function shouldFireDroppedEvent(dropEvent, date, allDay, calendarId) {
    return (dropEvent.dropData &&
        dropEvent.dropData.event &&
        (dropEvent.dropData.calendarId !== calendarId ||
            (dropEvent.dropData.event.allDay && !allDay) ||
            (!dropEvent.dropData.event.allDay && allDay)));
}
export function getWeekViewPeriod(dateAdapter, viewDate, weekStartsOn, excluded, daysInWeek) {
    if (excluded === void 0) { excluded = []; }
    var viewStart = daysInWeek
        ? dateAdapter.startOfDay(viewDate)
        : dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    var endOfWeek = dateAdapter.endOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    while (excluded.indexOf(dateAdapter.getDay(viewStart)) > -1 &&
        viewStart < endOfWeek) {
        viewStart = dateAdapter.addDays(viewStart, 1);
    }
    if (daysInWeek) {
        var viewEnd = dateAdapter.endOfDay(addDaysWithExclusions(dateAdapter, viewStart, daysInWeek - 1, excluded));
        return { viewStart: viewStart, viewEnd: viewEnd };
    }
    else {
        var viewEnd = endOfWeek;
        while (excluded.indexOf(dateAdapter.getDay(viewEnd)) > -1 &&
            viewEnd > viewStart) {
            viewEnd = dateAdapter.subDays(viewEnd, 1);
        }
        return { viewStart: viewStart, viewEnd: viewEnd };
    }
}
export function isWithinThreshold(_a) {
    var x = _a.x, y = _a.y;
    var DRAG_THRESHOLD = 1;
    return Math.abs(x) > DRAG_THRESHOLD || Math.abs(y) > DRAG_THRESHOLD;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItY2FsZW5kYXIvIiwic291cmNlcyI6WyJtb2R1bGVzL2NvbW1vbi91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBS0wsY0FBYyxJQUFJLHdCQUF3QixHQUkzQyxNQUFNLGdCQUFnQixDQUFDO0FBR3hCLE1BQU0sQ0FBQyxJQUFNLGNBQWMsR0FBRyxVQUFDLE1BQXVCO0lBQ3BELElBQU0sSUFBSSxHQUFHO1FBQUMsY0FBTzthQUFQLFVBQU8sRUFBUCxxQkFBTyxFQUFQLElBQU87WUFBUCx5QkFBTzs7UUFBSyxPQUFBLE9BQU8sQ0FBQyxJQUFJLE9BQVosT0FBTyxZQUFNLGtCQUFrQixHQUFLLElBQUk7SUFBeEMsQ0FBeUMsQ0FBQztJQUNwRSxPQUFPLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUM7QUFFRixNQUFNLFVBQVUsUUFBUSxDQUFDLEtBQWlCLEVBQUUsS0FBaUI7SUFDM0QsT0FBTyxDQUNMLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztRQUMvQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDaEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ2hELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUNqRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMs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LE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwRCxTQUFTLEdBQUcsU0FBUyxFQUNyQjtRQUNBLFNBQVMsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUMvQztJQUNELElBQUksVUFBVSxFQUFFO1FBQ2QsSUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLFFBQVEsQ0FDbEMscUJBQXFCLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxVQUFVLEdBQUcsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUN4RSxDQUFDO1FBQ0YsT0FBTyxFQUFFLFNBQVMsV0FBQSxFQUFFLE9BQU8sU0FBQSxFQUFFLENBQUM7S0FDL0I7U0FBTTtRQUNMLElBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQztRQUN4QixPQUNFLFFBQVEsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsRCxPQUFPLEdBQUcsU0FBUyxFQUNuQjtZQUNBLE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztTQUMzQztRQUNELE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxDQUFDO0tBQy9CO0FBQ0gsQ0FBQztBQUVELE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxFQUFrQztRQUFoQyxRQUFDLEVBQUUsUUFBQztJQUN0QyxJQUFNLGNBQWMsR0FBRyxDQUFDLENBQUM7SUFDekIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLGNBQWMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLGNBQWMsQ0FBQztBQUN0RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2FsZW5kYXJFdmVudCxcbiAgV2Vla1ZpZXdUaW1lRXZlbnQsXG4gIFdlZWtWaWV3SG91cixcbiAgV2Vla1ZpZXdIb3VyU2VnbWVudCxcbiAgdmFsaWRhdGVFdmVudHMgYXMgdmFsaWRhdGVFdmVudHNXaXRob3V0TG9nLFxuICBWaWV3UGVyaW9kLFxuICBXZWVrRGF5LFxuICBXZWVrVmlld0FsbERheUV2ZW50LFxufSBmcm9tICdjYWxlbmRhci11dGlscyc7XG5pbXBvcnQgeyBEYXRlQWRhcHRlciB9IGZyb20gJy4uLy4uL2RhdGUtYWRhcHRlcnMvZGF0ZS1hZGFwdGVyJztcblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlRXZlbnRzID0gKGV2ZW50czogQ2FsZW5kYXJFdmVudFtdKSA9PiB7XG4gIGNvbnN0IHdhcm4gPSAoLi4uYXJncykgPT4gY29uc29sZS53YXJuKCdhbmd1bGFyLWNhbGVuZGFyJywgLi4uYXJncyk7XG4gIHJldHVybiB2YWxpZGF0ZUV2ZW50c1dpdGhvdXRMb2coZXZlbnRzLCB3YXJuKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0luc2lkZShvdXRlcjogQ2xpZW50UmVjdCwgaW5uZXI6IENsaWVudFJlY3QpOiBib29sZWFuIHtcbiAgcmV0dXJuIChcbiAgICBNYXRoLmZsb29yKG91dGVyLmxlZnQpIDw9IE1hdGguY2VpbChpbm5lci5sZWZ0KSAmJlxuICAgIE1hdGguZmxvb3IoaW5uZXIubGVmdCkgPD0gTWF0aC5jZWlsKG91dGVyLnJpZ2h0KSAmJlxuICAgIE1hdGguZmxvb3Iob3V0ZXIubGVmdCkgPD0gTWF0aC5jZWlsKGlubmVyLnJpZ2h0KSAmJlxuICAgIE1hdGguZmxvb3IoaW5uZXIucmlnaHQpIDw9IE1hdGguY2VpbChvdXRlci5yaWdodCkgJiZcbiAgICBNYXRoLmZsb29yKG91dGVyLnRvcCkgPD0gTWF0aC5jZWlsKGlubmVyLnRvcCkgJiZcbiAgICBNYXRoLmZsb29yKGlubmVyLnRvcCkgPD0gTWF0aC5jZWlsKG91dGVyLmJvdHRvbSkgJiZcbiAgICBNYXRoLmZsb29yKG91dGVyLnRvcCkgPD0gTWF0aC5jZWlsKGlubmVyLmJvdHRvbSkgJiZcbiAgICBNYXRoLmZsb29yKGlubmVyLmJvdHRvbSkgPD0gTWF0aC5jZWlsKG91dGVyLmJvdHRvbSlcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJvdW5kVG9OZWFyZXN0KGFtb3VudDogbnVtYmVyLCBwcmVjaXNpb246IG51bWJlcikge1xuICByZXR1cm4gTWF0aC5yb3VuZChhbW91bnQgLyBwcmVjaXNpb24pICogcHJlY2lzaW9uO1xufVxuXG5leHBvcnQgY29uc3QgdHJhY2tCeUV2ZW50SWQgPSAoaW5kZXg6IG51bWJlciwgZXZlbnQ6IENhbGVuZGFyRXZlbnQpID0+XG4gIGV2ZW50LmlkID8gZXZlbnQuaWQgOiBldmVudDtcblxuZXhwb3J0IGNvbnN0IHRyYWNrQnlXZWVrRGF5SGVhZGVyRGF0ZSA9IChpbmRleDogbnVtYmVyLCBkYXk6IFdlZWtEYXkpID0+XG4gIGRheS5kYXRlLnRvSVNPU3RyaW5nKCk7XG5cbmV4cG9ydCBjb25zdCB0cmFja0J5SG91clNlZ21lbnQgPSAoXG4gIGluZGV4OiBudW1iZXIsXG4gIHNlZ21lbnQ6IFdlZWtWaWV3SG91clNlZ21lbnRcbikgPT4gc2VnbWVudC5kYXRlLnRvSVNPU3RyaW5nKCk7XG5cbmV4cG9ydCBjb25zdCB0cmFja0J5SG91ciA9IChpbmRleDogbnVtYmVyLCBob3VyOiBXZWVrVmlld0hvdXIpID0+XG4gIGhvdXIuc2VnbWVudHNbMF0uZGF0ZS50b0lTT1N0cmluZygpO1xuXG5leHBvcnQgY29uc3QgdHJhY2tCeVdlZWtBbGxEYXlFdmVudCA9IChcbiAgaW5kZXg6IG51bWJlcixcbiAgd2Vla0V2ZW50OiBXZWVrVmlld0FsbERheUV2ZW50XG4pID0+ICh3ZWVrRXZlbnQuZXZlbnQuaWQgPyB3ZWVrRXZlbnQuZXZlbnQuaWQgOiB3ZWVrRXZlbnQuZXZlbnQpO1xuXG5leHBvcnQgY29uc3QgdHJhY2tCeVdlZWtUaW1lRXZlbnQgPSAoXG4gIGluZGV4OiBudW1iZXIsXG4gIHdlZWtFdmVudDogV2Vla1ZpZXdUaW1lRXZlbnRcbikgPT4gKHdlZWtFdmVudC5ldmVudC5pZCA/IHdlZWtFdmVudC5ldmVudC5pZCA6IHdlZWtFdmVudC5ldmVudCk7XG5cbmNvbnN0IE1JTlVURVNfSU5fSE9VUiA9IDYwO1xuXG5mdW5jdGlvbiBnZXRQaXhlbEFtb3VudEluTWludXRlcyhcbiAgaG91clNlZ21lbnRzOiBudW1iZXIsXG4gIGhvdXJTZWdtZW50SGVpZ2h0OiBudW1iZXJcbikge1xuICByZXR1cm4gTUlOVVRFU19JTl9IT1VSIC8gKGhvdXJTZWdtZW50cyAqIGhvdXJTZWdtZW50SGVpZ2h0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1pbnV0ZXNNb3ZlZChcbiAgbW92ZWRZOiBudW1iZXIsXG4gIGhvdXJTZWdtZW50czogbnVtYmVyLFxuICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyLFxuICBldmVudFNuYXBTaXplOiBudW1iZXJcbik6IG51bWJlciB7XG4gIGNvbnN0IGRyYWdnZWRJblBpeGVsc1NuYXBTaXplID0gcm91bmRUb05lYXJlc3QoXG4gICAgbW92ZWRZLFxuICAgIGV2ZW50U25hcFNpemUgfHwgaG91clNlZ21lbnRIZWlnaHRcbiAgKTtcbiAgY29uc3QgcGl4ZWxBbW91bnRJbk1pbnV0ZXMgPSBnZXRQaXhlbEFtb3VudEluTWludXRlcyhcbiAgICBob3VyU2VnbWVudHMsXG4gICAgaG91clNlZ21lbnRIZWlnaHRcbiAgKTtcbiAgcmV0dXJuIGRyYWdnZWRJblBpeGVsc1NuYXBTaXplICogcGl4ZWxBbW91bnRJbk1pbnV0ZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNaW5pbXVtRXZlbnRIZWlnaHRJbk1pbnV0ZXMoXG4gIGhvdXJTZWdtZW50czogbnVtYmVyLFxuICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyXG4pIHtcbiAgcmV0dXJuIChcbiAgICBnZXRQaXhlbEFtb3VudEluTWludXRlcyhob3VyU2VnbWVudHMsIGhvdXJTZWdtZW50SGVpZ2h0KSAqIGhvdXJTZWdtZW50SGVpZ2h0XG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0RXZlbnRFbmQoXG4gIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcbiAgZXZlbnQ6IENhbGVuZGFyRXZlbnQsXG4gIG1pbmltdW1NaW51dGVzOiBudW1iZXJcbik6IERhdGUge1xuICBpZiAoZXZlbnQuZW5kKSB7XG4gICAgcmV0dXJuIGV2ZW50LmVuZDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZGF0ZUFkYXB0ZXIuYWRkTWludXRlcyhldmVudC5zdGFydCwgbWluaW11bU1pbnV0ZXMpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGREYXlzV2l0aEV4Y2x1c2lvbnMoXG4gIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcbiAgZGF0ZTogRGF0ZSxcbiAgZGF5czogbnVtYmVyLFxuICBleGNsdWRlZDogbnVtYmVyW11cbik6IERhdGUge1xuICBsZXQgZGF5c0NvdW50ZXIgPSAwO1xuICBsZXQgZGF5c1RvQWRkID0gMDtcbiAgY29uc3QgY2hhbmdlRGF5cyA9IGRheXMgPCAwID8gZGF0ZUFkYXB0ZXIuc3ViRGF5cyA6IGRhdGVBZGFwdGVyLmFkZERheXM7XG4gIGxldCByZXN1bHQgPSBkYXRlO1xuICB3aGlsZSAoZGF5c1RvQWRkIDw9IE1hdGguYWJzKGRheXMpKSB7XG4gICAgcmVzdWx0ID0gY2hhbmdlRGF5cyhkYXRlLCBkYXlzQ291bnRlcik7XG4gICAgY29uc3QgZGF5ID0gZGF0ZUFkYXB0ZXIuZ2V0RGF5KHJlc3VsdCk7XG4gICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2YoZGF5KSA9PT0gLTEpIHtcbiAgICAgIGRheXNUb0FkZCsrO1xuICAgIH1cbiAgICBkYXlzQ291bnRlcisrO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0RyYWdnZWRXaXRoaW5QZXJpb2QoXG4gIG5ld1N0YXJ0OiBEYXRlLFxuICBuZXdFbmQ6IERhdGUsXG4gIHBlcmlvZDogVmlld1BlcmlvZFxuKTogYm9vbGVhbiB7XG4gIGNvbnN0IGVuZCA9IG5ld0VuZCB8fCBuZXdTdGFydDtcbiAgcmV0dXJuIChcbiAgICAocGVyaW9kLnN0YXJ0IDw9IG5ld1N0YXJ0ICYmIG5ld1N0YXJ0IDw9IHBlcmlvZC5lbmQpIHx8XG4gICAgKHBlcmlvZC5zdGFydCA8PSBlbmQgJiYgZW5kIDw9IHBlcmlvZC5lbmQpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaG91bGRGaXJlRHJvcHBlZEV2ZW50KFxuICBkcm9wRXZlbnQ6IHsgZHJvcERhdGE/OiB7IGV2ZW50PzogQ2FsZW5kYXJFdmVudDsgY2FsZW5kYXJJZD86IHN5bWJvbCB9IH0sXG4gIGRhdGU6IERhdGUsXG4gIGFsbERheTogYm9vbGVhbixcbiAgY2FsZW5kYXJJZDogc3ltYm9sXG4pIHtcbiAgcmV0dXJuIChcbiAgICBkcm9wRXZlbnQuZHJvcERhdGEgJiZcbiAgICBkcm9wRXZlbnQuZHJvcERhdGEuZXZlbnQgJiZcbiAgICAoZHJvcEV2ZW50LmRyb3BEYXRhLmNhbGVuZGFySWQgIT09IGNhbGVuZGFySWQgfHxcbiAgICAgIChkcm9wRXZlbnQuZHJvcERhdGEuZXZlbnQuYWxsRGF5ICYmICFhbGxEYXkpIHx8XG4gICAgICAoIWRyb3BFdmVudC5kcm9wRGF0YS5ldmVudC5hbGxEYXkgJiYgYWxsRGF5KSlcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtWaWV3UGVyaW9kKFxuICBkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsXG4gIHZpZXdEYXRlOiBEYXRlLFxuICB3ZWVrU3RhcnRzT246IG51bWJlcixcbiAgZXhjbHVkZWQ6IG51bWJlcltdID0gW10sXG4gIGRheXNJbldlZWs/OiBudW1iZXJcbik6IHsgdmlld1N0YXJ0OiBEYXRlOyB2aWV3RW5kOiBEYXRlIH0ge1xuICBsZXQgdmlld1N0YXJ0ID0gZGF5c0luV2Vla1xuICAgID8gZGF0ZUFkYXB0ZXIuc3RhcnRPZkRheSh2aWV3RGF0ZSlcbiAgICA6IGRhdGVBZGFwdGVyLnN0YXJ0T2ZXZWVrKHZpZXdEYXRlLCB7IHdlZWtTdGFydHNPbiB9KTtcbiAgY29uc3QgZW5kT2ZXZWVrID0gZGF0ZUFkYXB0ZXIuZW5kT2ZXZWVrKHZpZXdEYXRlLCB7IHdlZWtTdGFydHNPbiB9KTtcbiAgd2hpbGUgKFxuICAgIGV4Y2x1ZGVkLmluZGV4T2YoZGF0ZUFkYXB0ZXIuZ2V0RGF5KHZpZXdTdGFydCkpID4gLTEgJiZcbiAgICB2aWV3U3RhcnQgPCBlbmRPZldlZWtcbiAgKSB7XG4gICAgdmlld1N0YXJ0ID0gZGF0ZUFkYXB0ZXIuYWRkRGF5cyh2aWV3U3RhcnQsIDEpO1xuICB9XG4gIGlmIChkYXlzSW5XZWVrKSB7XG4gICAgY29uc3Qgdmlld0VuZCA9IGRhdGVBZGFwdGVyLmVuZE9mRGF5KFxuICAgICAgYWRkRGF5c1dpdGhFeGNsdXNpb25zKGRhdGVBZGFwdGVyLCB2aWV3U3RhcnQsIGRheXNJbldlZWsgLSAxLCBleGNsdWRlZClcbiAgICApO1xuICAgIHJldHVybiB7IHZpZXdTdGFydCwgdmlld0VuZCB9O1xuICB9IGVsc2Uge1xuICAgIGxldCB2aWV3RW5kID0gZW5kT2ZXZWVrO1xuICAgIHdoaWxlIChcbiAgICAgIGV4Y2x1ZGVkLmluZGV4T2YoZGF0ZUFkYXB0ZXIuZ2V0RGF5KHZpZXdFbmQpKSA+IC0xICYmXG4gICAgICB2aWV3RW5kID4gdmlld1N0YXJ0XG4gICAgKSB7XG4gICAgICB2aWV3RW5kID0gZGF0ZUFkYXB0ZXIuc3ViRGF5cyh2aWV3RW5kLCAxKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgdmlld1N0YXJ0LCB2aWV3RW5kIH07XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzV2l0aGluVGhyZXNob2xkKHsgeCwgeSB9OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0pIHtcbiAgY29uc3QgRFJBR19USFJFU0hPTEQgPSAxO1xuICByZXR1cm4gTWF0aC5hYnMoeCkgPiBEUkFHX1RIUkVTSE9MRCB8fCBNYXRoLmFicyh5KSA+IERSQUdfVEhSRVNIT0xEO1xufVxuIl19